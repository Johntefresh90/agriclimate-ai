<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Assistant - Agriclimate Connect</title>
    <link href="https://cdn.tailwindcss.com/3.4.0" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#22c55e',
                        secondary: '#15803d',
                        accent: '#84cc16',
                        earth: '#a3a3a3',
                        sky: '#0ea5e9',
                        warning: '#f59e0b',
                        danger: '#ef4444'
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        .climate-gradient {
            background: linear-gradient(135deg, #22c55e 0%, #15803d 50%, #84cc16 100%);
        }
        .ai-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .chat-bubble {
            max-width: 85%;
            word-wrap: break-word;
        }
        .ai-thinking {
            background: linear-gradient(90deg, #e5e7eb, #f3f4f6, #e5e7eb);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: white;
            min-width: 200px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1000;
            border-radius: 8px;
            padding: 10px 0;
        }
        .dropdown:hover .dropdown-content {
            display: block;
        }
        .mobile-menu {
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
        }
        .mobile-menu.active {
            transform: translateX(0);
        }
        .voice-animation {
            animation: pulse 1.5s infinite;
        }
        .language-flag {
            width: 20px;
            height: 15px;
            display: inline-block;
            background-size: cover;
            border-radius: 2px;
            margin-right: 8px;
        }
        .typing-indicator {
            display: flex;
            align-items: center;
            padding: 16px;
        }
        .typing-indicator span {
            height: 8px;
            width: 8px;
            border-radius: 50%;
            background-color: #9ca3af;
            display: inline-block;
            margin-right: 4px;
            animation: typing 1.4s infinite ease-in-out;
        }
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }
        .feature-card {
            transition: all 0.3s ease;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .scroll-smooth {
            scroll-behavior: smooth;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="font-sans bg-gray-50 dark:bg-gray-900 transition-colors duration-300 scroll-smooth">
    <!-- Navigation Header -->
    <nav class="bg-white dark:bg-gray-800 shadow-lg sticky top-0 z-50 transition-colors duration-300">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 climate-gradient rounded-full flex items-center justify-center">
                        <i class="fas fa-seedling text-white text-lg"></i>
                    </div>
                    <span class="text-2xl font-bold text-gray-800 dark:text-white">Agriclimate Connect</span>
                </div>

                <!-- Desktop Navigation -->
                <div class="hidden lg:flex items-center space-x-8">
                    <a href="index.html" class="text-gray-700 dark:text-gray-300 hover:text-primary transition-colors">Home</a>
                    
                    <!-- Features Dropdown -->
                    <div class="dropdown relative">
                        <button class="text-gray-700 dark:text-gray-300 hover:text-primary transition-colors flex items-center">
                            Features <i class="fas fa-chevron-down ml-1"></i>
                        </button>
                        <div class="dropdown-content dark:bg-gray-700">
                            <a href="weather.html" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-primary hover:text-white">Weather & Climate</a>
                            <a href="crop-advisory.html" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-primary hover:text-white">Crop Advisory</a>
                            <a href="livestock.html" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-primary hover:text-white">Livestock Advisory</a>
                            <a href="market-hub.html" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-primary hover:text-white">Market Hub</a>
                            <a href="#" class="block px-4 py-2 text-primary font-semibold hover:bg-primary hover:text-white">AI Assistant</a>
                        </div>
                    </div>

                    <!-- Services Dropdown -->
                    <div class="dropdown relative">
                        <button class="text-gray-700 dark:text-gray-300 hover:text-primary transition-colors flex items-center">
                            Services <i class="fas fa-chevron-down ml-1"></i>
                        </button>
                        <div class="dropdown-content dark:bg-gray-700">
                            <a href="#voice-assistant" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-primary hover:text-white">Voice Assistant</a>
                            <a href="#translation" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-primary hover:text-white">Real-time Translation</a>
                            <a href="#expert-mode" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-primary hover:text-white">Expert Mode</a>
                            <a href="#api-access" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-primary hover:text-white">API Access</a>
                        </div>
                    </div>

                    <!-- Community Dropdown -->
                    <div class="dropdown relative">
                        <button class="text-gray-700 dark:text-gray-300 hover:text-primary transition-colors flex items-center">
                            Community <i class="fas fa-chevron-down ml-1"></i>
                        </button>
                        <div class="dropdown-content dark:bg-gray-700">
                            <a href="#forum" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-primary hover:text-white">Discussion Forum</a>
                            <a href="#experts" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-primary hover:text-white">Ask Experts</a>
                            <a href="#success-stories" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-primary hover:text-white">Success Stories</a>
                            <a href="#mentorship" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-primary hover:text-white">Mentorship</a>
                        </div>
                    </div>

                    <!-- Resources Dropdown -->
                    <div class="dropdown relative">
                        <button class="text-gray-700 dark:text-gray-300 hover:text-primary transition-colors flex items-center">
                            Resources <i class="fas fa-chevron-down ml-1"></i>
                        </button>
                        <div class="dropdown-content dark:bg-gray-700">
                            <a href="#knowledge" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-primary hover:text-white">Knowledge Center</a>
                            <a href="#training" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-primary hover:text-white">Training Programs</a>
                            <a href="#downloads" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-primary hover:text-white">Downloads</a>
                            <a href="#funding" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-primary hover:text-white">Funding & Grants</a>
                        </div>
                    </div>

                    <a href="#about" class="text-gray-700 dark:text-gray-300 hover:text-primary transition-colors">About</a>
                    <a href="#contact" class="text-gray-700 dark:text-gray-300 hover:text-primary transition-colors">Contact</a>
                </div>

                <!-- Language Selector -->
                <div class="hidden md:flex items-center">
                    <div class="relative">
                        <select id="languageSelector" class="bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-white rounded px-3 py-1 text-sm pr-8 appearance-none">
                            <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                            <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                            <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                            <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                            <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                            <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                            <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                            <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                            <option value="hi">ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
                            <option value="pt">ğŸ‡§ğŸ‡· PortuguÃªs</option>
                            <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                            <option value="sw">ğŸ‡°ğŸ‡ª Kiswahili</option>
                            <option value="am">ğŸ‡ªğŸ‡¹ áŠ áˆ›áˆ­áŠ›</option>
                            <option value="yo">ğŸ‡³ğŸ‡¬ YorÃ¹bÃ¡</option>
                            <option value="ha">ğŸ‡³ğŸ‡¬ Hausa</option>
                            <option value="ig">ğŸ‡³ğŸ‡¬ Igbo</option>
                            <option value="zu">ğŸ‡¿ğŸ‡¦ isiZulu</option>
                            <option value="xh">ğŸ‡¿ğŸ‡¦ isiXhosa</option>
                            <option value="af">ğŸ‡¿ğŸ‡¦ Afrikaans</option>
                            <option value="so">ğŸ‡¸ğŸ‡´ Soomaali</option>
                        </select>
                        <i class="fas fa-chevron-down absolute right-2 top-2 text-gray-400 pointer-events-none"></i>
                    </div>
                </div>

                <!-- Auth Buttons -->
                <div class="hidden lg:flex items-center space-x-4">
                    <button class="text-gray-700 dark:text-gray-300 hover:text-primary transition-colors">Login</button>
                    <button class="bg-primary text-white px-6 py-2 rounded-full hover:bg-secondary transition-colors">Register</button>
                </div>

                <!-- Mobile Menu Button -->
                <button id="mobileMenuButton" class="lg:hidden text-gray-700 dark:text-gray-300">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>

        <!-- Mobile Menu -->
        <div id="mobileMenu" class="mobile-menu lg:hidden fixed inset-y-0 left-0 z-50 w-64 bg-white dark:bg-gray-800 shadow-lg">
            <div class="p-4">
                <div class="flex justify-between items-center mb-6">
                    <span class="text-xl font-bold text-gray-800 dark:text-white">Menu</span>
                    <button id="closeMobileMenu" class="text-gray-500 dark:text-gray-400">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <nav class="space-y-4">
                    <a href="index.html" class="block text-gray-700 dark:text-gray-300 hover:text-primary transition-colors">Home</a>
                    <div class="space-y-2">
                        <button class="w-full text-left text-gray-700 dark:text-gray-300 hover:text-primary transition-colors mobile-dropdown-toggle">
                            Features <i class="fas fa-chevron-down float-right mt-1"></i>
                        </button>
                        <div class="mobile-dropdown-content pl-4 space-y-2 hidden">
                            <a href="weather.html" class="block text-gray-600 dark:text-gray-400 hover:text-primary">Weather & Climate</a>
                            <a href="crop-advisory.html" class="block text-gray-600 dark:text-gray-400 hover:text-primary">Crop Advisory</a>
                            <a href="livestock.html" class="block text-gray-600 dark:text-gray-400 hover:text-primary">Livestock Advisory</a>
                            <a href="market-hub.html" class="block text-gray-600 dark:text-gray-400 hover:text-primary">Market Hub</a>
                            <a href="#" class="block text-primary font-semibold">AI Assistant</a>
                        </div>
                    </div>
                    <a href="#community" class="block text-gray-700 dark:text-gray-300 hover:text-primary transition-colors">Community</a>
                    <a href="#resources" class="block text-gray-700 dark:text-gray-300 hover:text-primary transition-colors">Resources</a>
                    <a href="#about" class="block text-gray-700 dark:text-gray-300 hover:text-primary transition-colors">About</a>
                    <a href="#contact" class="block text-gray-700 dark:text-gray-300 hover:text-primary transition-colors">Contact</a>
                </nav>
                <div class="mt-6 space-y-3">
                    <button class="w-full text-left text-gray-700 dark:text-gray-300 hover:text-primary transition-colors">Login</button>
                    <button class="w-full bg-primary text-white py-2 rounded-full hover:bg-secondary transition-colors">Register</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="ai-gradient text-white py-12">
        <div class="container mx-auto px-4">
            <div class="text-center">
                <h1 class="text-4xl lg:text-5xl font-bold mb-4">
                    <i class="fas fa-robot mr-3"></i>AI Agricultural Assistant
                </h1>
                <p class="text-xl opacity-90 mb-6">Your multilingual AI expert for climate-smart agriculture - available in 20+ languages</p>
                <div class="flex justify-center items-center space-x-6">
                    <div class="text-center">
                        <div class="text-2xl font-bold">24/7</div>
                        <div class="text-sm opacity-75">Always Available</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold">20+</div>
                        <div class="text-sm opacity-75">Languages</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold">99.9%</div>
                        <div class="text-sm opacity-75">Accuracy Rate</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- AI Assistant Features -->
    <section class="py-8 -mt-6">
        <div class="container mx-auto px-4">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 mb-8">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6 text-center">
                    <i class="fas fa-brain text-primary mr-2"></i>Intelligent Agricultural Assistance
                </h2>
                
                <div class="grid md:grid-cols-4 gap-6 mb-8">
                    <div class="feature-card bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 p-6 rounded-xl text-center">
                        <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-leaf text-white text-2xl"></i>
                        </div>
                        <h3 class="font-semibold text-gray-800 dark:text-white mb-2">Crop Guidance</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-300">Expert advice on crop selection, planting, and harvesting</p>
                    </div>

                    <div class="feature-card bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 p-6 rounded-xl text-center">
                        <div class="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-cloud-sun text-white text-2xl"></i>
                        </div>
                        <h3 class="font-semibold text-gray-800 dark:text-white mb-2">Weather Insights</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-300">Climate analysis and weather-based recommendations</p>
                    </div>

                    <div class="feature-card bg-gradient-to-br from-purple-50 to-indigo-50 dark:from-purple-900/20 dark:to-indigo-900/20 p-6 rounded-xl text-center">
                        <div class="w-16 h-16 bg-purple-500 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-paw text-white text-2xl"></i>
                        </div>
                        <h3 class="font-semibold text-gray-800 dark:text-white mb-2">Livestock Care</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-300">Animal health, breeding, and management advice</p>
                    </div>

                    <div class="feature-card bg-gradient-to-br from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 p-6 rounded-xl text-center">
                        <div class="w-16 h-16 bg-orange-500 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-chart-line text-white text-2xl"></i>
                        </div>
                        <h3 class="font-semibold text-gray-800 dark:text-white mb-2">Market Intelligence</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-300">Pricing trends and market opportunities</p>
                    </div>
                </div>

                <!-- Quick Action Buttons -->
                <div class="grid md:grid-cols-3 gap-4">
                    <button id="voiceAssistant" class="bg-gradient-to-r from-green-500 to-emerald-500 text-white p-4 rounded-xl hover:from-green-600 hover:to-emerald-600 transition-all duration-300">
                        <i class="fas fa-microphone text-2xl mb-2"></i>
                        <h3 class="font-semibold">Voice Assistant</h3>
                        <p class="text-sm opacity-90">Speak your questions naturally</p>
                    </button>
                    
                    <button id="expertMode" class="bg-gradient-to-r from-blue-500 to-cyan-500 text-white p-4 rounded-xl hover:from-blue-600 hover:to-cyan-600 transition-all duration-300">
                        <i class="fas fa-user-graduate text-2xl mb-2"></i>
                        <h3 class="font-semibold">Expert Mode</h3>
                        <p class="text-sm opacity-90">Advanced agricultural analysis</p>
                    </button>
                    
                    <button id="quickTranslate" class="bg-gradient-to-r from-purple-500 to-indigo-500 text-white p-4 rounded-xl hover:from-purple-600 hover:to-indigo-600 transition-all duration-300">
                        <i class="fas fa-language text-2xl mb-2"></i>
                        <h3 class="font-semibold">Translate</h3>
                        <p class="text-sm opacity-90">Instant language translation</p>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Main AI Chat Interface -->
    <section class="py-8">
        <div class="container mx-auto px-4">
            <div class="grid lg:grid-cols-4 gap-8">
                <!-- Main Chat Area -->
                <div class="lg:col-span-3">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl h-[600px] flex flex-col">
                        <!-- Chat Header -->
                        <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 ai-gradient rounded-full flex items-center justify-center">
                                    <i class="fas fa-robot text-white text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-bold text-gray-800 dark:text-white">AgriBot AI</h3>
                                    <p class="text-sm text-gray-600 dark:text-gray-300">
                                        <span class="inline-block w-2 h-2 bg-green-500 rounded-full mr-1"></span>
                                        Online â€¢ Speaking <span id="currentLanguage">English</span>
                                    </p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button id="clearChat" class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                                <button id="downloadChat" class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button id="chatSettings" class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                                    <i class="fas fa-cog"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Chat Messages Area -->
                        <div id="chatContainer" class="flex-1 overflow-y-auto p-6 space-y-4">
                            <div id="chatMessages">
                                <!-- Welcome Message -->
                                <div class="flex items-start space-x-3">
                                    <div class="w-8 h-8 ai-gradient rounded-full flex items-center justify-center flex-shrink-0">
                                        <i class="fas fa-robot text-white text-sm"></i>
                                    </div>
                                    <div class="chat-bubble bg-gray-100 dark:bg-gray-700 p-4 rounded-lg">
                                        <p id="welcomeMessage" class="text-gray-800 dark:text-white">Hello! I'm your AI agricultural assistant. I can help you with farming questions in any language. How can I assist you today?</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Chat Input Area -->
                        <div class="p-6 border-t border-gray-200 dark:border-gray-700">
                            <!-- Input Controls -->
                            <div class="flex items-center space-x-2 mb-4">
                                <button id="voiceInput" class="p-2 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                    <i class="fas fa-microphone"></i>
                                </button>
                                <button id="attachFile" class="p-2 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                    <i class="fas fa-paperclip"></i>
                                </button>
                                <button id="takePicture" class="p-2 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                    <i class="fas fa-camera"></i>
                                </button>
                                <div class="flex-1"></div>
                                <select id="chatLanguage" class="px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded text-sm">
                                    <option value="en">English</option>
                                    <option value="es">EspaÃ±ol</option>
                                    <option value="fr">FranÃ§ais</option>
                                    <option value="sw">Kiswahili</option>
                                    <option value="hi">à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
                                    <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                                    <option value="zh">ä¸­æ–‡</option>
                                    <option value="pt">PortuguÃªs</option>
                                </select>
                            </div>

                            <!-- Message Input -->
                            <div class="flex space-x-4">
                                <input type="text" id="chatInput" placeholder="Ask me anything about agriculture..." 
                                       class="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:border-primary dark:bg-gray-700 dark:text-white text-base">
                                <button id="sendMessage" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-colors">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>

                            <!-- Quick Suggestions -->
                            <div class="mt-4">
                                <div class="text-sm text-gray-600 dark:text-gray-400 mb-2">Quick suggestions:</div>
                                <div id="quickSuggestions" class="flex flex-wrap gap-2">
                                    <!-- Suggestions will be populated based on language -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="space-y-6">
                    <!-- Language Selector -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">
                            <i class="fas fa-globe text-primary mr-2"></i>Language Settings
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm text-gray-600 dark:text-gray-300 mb-1">Preferred Language</label>
                                <select id="preferredLanguage" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:border-primary dark:bg-gray-700 dark:text-white">
                                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                                    <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                                    <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                                    <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                                    <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                                    <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                                    <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                                    <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                                    <option value="hi">ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
                                    <option value="pt">ğŸ‡§ğŸ‡· PortuguÃªs</option>
                                    <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                                    <option value="sw">ğŸ‡°ğŸ‡ª Kiswahili</option>
                                    <option value="am">ğŸ‡ªğŸ‡¹ áŠ áˆ›áˆ­áŠ›</option>
                                    <option value="yo">ğŸ‡³ğŸ‡¬ YorÃ¹bÃ¡</option>
                                    <option value="ha">ğŸ‡³ğŸ‡¬ Hausa</option>
                                    <option value="ig">ğŸ‡³ğŸ‡¬ Igbo</option>
                                    <option value="zu">ğŸ‡¿ğŸ‡¦ isiZulu</option>
                                    <option value="xh">ğŸ‡¿ğŸ‡¦ isiXhosa</option>
                                    <option value="af">ğŸ‡¿ğŸ‡¦ Afrikaans</option>
                                    <option value="so">ğŸ‡¸ğŸ‡´ Soomaali</option>
                                </select>
                            </div>
                            <div class="flex items-center space-x-2">
                                <input type="checkbox" id="autoDetect" checked class="text-primary focus:ring-primary">
                                <label for="autoDetect" class="text-sm text-gray-600 dark:text-gray-300">Auto-detect language</label>
                            </div>
                            <div class="flex items-center space-x-2">
                                <input type="checkbox" id="autoTranslate" class="text-primary focus:ring-primary">
                                <label for="autoTranslate" class="text-sm text-gray-600 dark:text-gray-300">Auto-translate responses</label>
                            </div>
                        </div>
                    </div>

                    <!-- AI Capabilities -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">
                            <i class="fas fa-cogs text-primary mr-2"></i>AI Capabilities
                        </h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600 dark:text-gray-300">Voice Recognition</span>
                                <div class="w-8 h-4 bg-green-500 rounded-full relative">
                                    <div class="w-4 h-4 bg-white rounded-full absolute right-0 top-0 shadow"></div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600 dark:text-gray-300">Image Analysis</span>
                                <div class="w-8 h-4 bg-green-500 rounded-full relative">
                                    <div class="w-4 h-4 bg-white rounded-full absolute right-0 top-0 shadow"></div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600 dark:text-gray-300">Real-time Translation</span>
                                <div class="w-8 h-4 bg-green-500 rounded-full relative">
                                    <div class="w-4 h-4 bg-white rounded-full absolute right-0 top-0 shadow"></div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600 dark:text-gray-300">Expert Knowledge</span>
                                <div class="w-8 h-4 bg-green-500 rounded-full relative">
                                    <div class="w-4 h-4 bg-white rounded-full absolute right-0 top-0 shadow"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Topics -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">
                            <i class="fas fa-history text-primary mr-2"></i>Recent Topics
                        </h3>
                        <div id="recentTopics" class="space-y-2">
                            <button class="w-full text-left p-2 text-sm text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">
                                Crop rotation strategies
                            </button>
                            <button class="w-full text-left p-2 text-sm text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">
                                Pest identification
                            </button>
                            <button class="w-full text-left p-2 text-sm text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">
                                Weather alerts
                            </button>
                            <button class="w-full text-left p-2 text-sm text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">
                                Market prices
                            </button>
                        </div>
                    </div>

                    <!-- Support -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">
                            <i class="fas fa-question-circle text-primary mr-2"></i>Need Help?
                        </h3>
                        <div class="space-y-3">
                            <button class="w-full bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 p-3 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/40 transition-colors text-left text-sm">
                                <i class="fas fa-book mr-2"></i>User Guide
                            </button>
                            <button class="w-full bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300 p-3 rounded-lg hover:bg-green-100 dark:hover:bg-green-900/40 transition-colors text-left text-sm">
                                <i class="fas fa-headset mr-2"></i>Live Support
                            </button>
                            <button class="w-full bg-purple-50 dark:bg-purple-900/20 text-purple-700 dark:text-purple-300 p-3 rounded-lg hover:bg-purple-100 dark:hover:bg-purple-900/40 transition-colors text-left text-sm">
                                <i class="fas fa-feedback mr-2"></i>Send Feedback
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Voice Assistant Modal -->
    <div id="voiceModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 max-w-md w-full mx-4">
            <div class="text-center">
                <div id="voiceIndicator" class="w-24 h-24 ai-gradient rounded-full flex items-center justify-center mx-auto mb-6">
                    <i id="voiceIcon" class="fas fa-microphone text-white text-3xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-2">Voice Assistant</h3>
                <p id="voiceStatus" class="text-gray-600 dark:text-gray-300 mb-6">Click to start speaking</p>
                <div class="space-y-4">
                    <button id="startVoice" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-colors">
                        <i class="fas fa-microphone mr-2"></i>Start Listening
                    </button>
                    <button id="closeVoiceModal" class="bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 px-6 py-3 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors ml-3">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer id="contact" class="bg-gray-900 text-white py-16">
        <div class="container mx-auto px-4">
            <div class="grid lg:grid-cols-4 gap-8 mb-12">
                <!-- Company Info -->
                <div>
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="w-10 h-10 climate-gradient rounded-full flex items-center justify-center">
                            <i class="fas fa-seedling text-white text-lg"></i>
                        </div>
                        <span class="text-2xl font-bold">Agriclimate Connect</span>
                    </div>
                    <p class="text-gray-300 mb-6">Revolutionizing agriculture through AI-powered climate-smart solutions and multilingual support for farmers worldwide.</p>
                    <div class="flex space-x-4">
                        <a href="#" class="w-10 h-10 bg-gray-700 rounded-full flex items-center justify-center hover:bg-primary transition-colors">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="w-10 h-10 bg-gray-700 rounded-full flex items-center justify-center hover:bg-primary transition-colors">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="w-10 h-10 bg-gray-700 rounded-full flex items-center justify-center hover:bg-primary transition-colors">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                        <a href="#" class="w-10 h-10 bg-gray-700 rounded-full flex items-center justify-center hover:bg-primary transition-colors">
                            <i class="fab fa-youtube"></i>
                        </a>
                    </div>
                </div>
                
                <!-- Quick Links -->
                <div>
                    <h3 class="text-lg font-semibold mb-6">Quick Links</h3>
                    <ul class="space-y-3">
                        <li><a href="#features" class="text-gray-300 hover:text-primary transition-colors">Features</a></li>
                        <li><a href="#weather" class="text-gray-300 hover:text-primary transition-colors">Weather Insights</a></li>
                        <li><a href="#crops" class="text-gray-300 hover:text-primary transition-colors">Crop Advisory</a></li>
                        <li><a href="#livestock" class="text-gray-300 hover:text-primary transition-colors">Livestock Management</a></li>
                        <li><a href="#market" class="text-gray-300 hover:text-primary transition-colors">Market Hub</a></li>
                        <li><a href="#community" class="text-gray-300 hover:text-primary transition-colors">Community</a></li>
                    </ul>
                </div>
                
                <!-- Resources -->
                <div>
                    <h3 class="text-lg font-semibold mb-6">Resources</h3>
                    <ul class="space-y-3">
                        <li><a href="#knowledge" class="text-gray-300 hover:text-primary transition-colors">Knowledge Center</a></li>
                        <li><a href="#training" class="text-gray-300 hover:text-primary transition-colors">Training Programs</a></li>
                        <li><a href="#downloads" class="text-gray-300 hover:text-primary transition-colors">Downloads</a></li>
                        <li><a href="#funding" class="text-gray-300 hover:text-primary transition-colors">Funding & Grants</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-primary transition-colors">API Documentation</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-primary transition-colors">Support Center</a></li>
                    </ul>
                </div>
                
                <!-- Contact & Newsletter -->
                <div>
                    <h3 class="text-lg font-semibold mb-6">Stay Connected</h3>
                    <div class="space-y-4">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-envelope text-primary"></i>
                            <span class="text-gray-300">support@agriclimateconnect.com</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-phone text-primary"></i>
                            <span class="text-gray-300">+1-800-AGRI-TECH</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-map-marker-alt text-primary"></i>
                            <span class="text-gray-300">Global Headquarters</span>
                        </div>
                    </div>
                    
                    <!-- Newsletter Signup -->
                    <div class="mt-6">
                        <h4 class="font-semibold mb-3">Newsletter</h4>
                        <div class="flex space-x-2">
                            <input type="email" placeholder="Your email" class="flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:border-primary text-base">
                            <button class="bg-primary text-white px-4 py-2 rounded hover:bg-secondary transition-colors">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Bottom Bar -->
            <div class="border-t border-gray-700 pt-8">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="text-gray-300 text-sm mb-4 md:mb-0">
                        Â© 2024 Agriclimate Connect. All rights reserved.
                    </div>
                    <div class="flex space-x-6 text-sm">
                        <a href="#" class="text-gray-300 hover:text-primary transition-colors">Privacy Policy</a>
                        <a href="#" class="text-gray-300 hover:text-primary transition-colors">Terms of Service</a>
                        <a href="#" class="text-gray-300 hover:text-primary transition-colors">Cookie Policy</a>
                        <a href="#" class="text-gray-300 hover:text-primary transition-colors">Data Protection</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Global variables
        let currentLanguage = 'en';
        let conversationHistory = [];
        let isVoiceRecording = false;
        let isAIResponding = false;
        let recognition = null;
        let synthesis = window.speechSynthesis;

        // Language configurations
        const languageConfig = {
            en: {
                name: 'English',
                welcome: 'Hello! I\'m your AI agricultural assistant. I can help you with farming questions in any language. How can I assist you today?',
                suggestions: [
                    'What crops should I plant this season?',
                    'How do I prepare for drought?',
                    'Best practices for organic farming',
                    'Market prices for my region'
                ]
            },
            es: {
                name: 'EspaÃ±ol',
                welcome: 'Â¡Hola! Soy tu asistente agrÃ­cola de IA. Puedo ayudarte con preguntas de agricultura en cualquier idioma. Â¿CÃ³mo puedo asistirte hoy?',
                suggestions: [
                    'Â¿QuÃ© cultivos debo plantar esta temporada?',
                    'Â¿CÃ³mo me preparo para la sequÃ­a?',
                    'Mejores prÃ¡cticas para agricultura orgÃ¡nica',
                    'Precios de mercado para mi regiÃ³n'
                ]
            },
            fr: {
                name: 'FranÃ§ais',
                welcome: 'Bonjour! Je suis votre assistant agricole IA. Je peux vous aider avec des questions agricoles dans n\'importe quelle langue. Comment puis-je vous aider aujourd\'hui?',
                suggestions: [
                    'Quelles cultures dois-je planter cette saison?',
                    'Comment me prÃ©parer Ã  la sÃ©cheresse?',
                    'Meilleures pratiques pour l\'agriculture biologique',
                    'Prix du marchÃ© pour ma rÃ©gion'
                ]
            },
            sw: {
                name: 'Kiswahili',
                welcome: 'Hujambo! Mimi ni msaidizi wako wa kilimo wa AI. Ninaweza kukusaidia na maswali ya kilimo kwa lugha yoyote. Ninawezaje kukusaidia leo?',
                suggestions: [
                    'Ni mazao gani nipande msimu huu?',
                    'Ninajiandaaje kwa ukame?',
                    'Mbinu bora za kilimo asili',
                    'Bei za soko za eneo langu'
                ]
            },
            hi: {
                name: 'à¤¹à¤¿à¤¨à¥à¤¦à¥€',
                welcome: 'à¤¨à¤®à¤¸à¥à¤¤à¥‡! à¤®à¥ˆà¤‚ à¤†à¤ªà¤•à¤¾ AI à¤•à¥ƒà¤·à¤¿ à¤¸à¤¹à¤¾à¤¯à¤• à¤¹à¥‚à¤‚à¥¤ à¤®à¥ˆà¤‚ à¤•à¤¿à¤¸à¥€ à¤­à¥€ à¤­à¤¾à¤·à¤¾ à¤®à¥‡à¤‚ à¤•à¥ƒà¤·à¤¿ à¤ªà¥à¤°à¤¶à¥à¤¨à¥‹à¤‚ à¤®à¥‡à¤‚ à¤†à¤ªà¤•à¥€ à¤®à¤¦à¤¦ à¤•à¤° à¤¸à¤•à¤¤à¤¾ à¤¹à¥‚à¤‚à¥¤ à¤†à¤œ à¤®à¥ˆà¤‚ à¤†à¤ªà¤•à¥€ à¤•à¥ˆà¤¸à¥‡ à¤¸à¤¹à¤¾à¤¯à¤¤à¤¾ à¤•à¤° à¤¸à¤•à¤¤à¤¾ à¤¹à¥‚à¤‚?',
                suggestions: [
                    'à¤‡à¤¸ à¤®à¥Œà¤¸à¤® à¤®à¥‡à¤‚ à¤•à¥Œà¤¨ à¤¸à¥€ à¤«à¤¸à¤² à¤²à¤—à¤¾à¤¨à¥€ à¤šà¤¾à¤¹à¤¿à¤?',
                    'à¤¸à¥‚à¤–à¥‡ à¤•à¥€ à¤¤à¥ˆà¤¯à¤¾à¤°à¥€ à¤•à¥ˆà¤¸à¥‡ à¤•à¤°à¥‡à¤‚?',
                    'à¤œà¥ˆà¤µà¤¿à¤• à¤–à¥‡à¤¤à¥€ à¤•à¥€ à¤¸à¤°à¥à¤µà¥‹à¤¤à¥à¤¤à¤® à¤ªà¥à¤°à¤¥à¤¾à¤à¤‚',
                    'à¤®à¥‡à¤°à¥‡ à¤•à¥à¤·à¥‡à¤¤à¥à¤° à¤•à¥‡ à¤¬à¤¾à¤œà¤¾à¤° à¤­à¤¾à¤µ'
                ]
            },
            ar: {
                name: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©',
                welcome: 'Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ. ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø²Ø±Ø§Ø¹Ø© Ø¨Ø£ÙŠ Ù„ØºØ©. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ',
                suggestions: [
                    'Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ù…Ø­Ø§ØµÙŠÙ„ Ø§Ù„ØªÙŠ ÙŠØ¬Ø¨ Ø£Ù† Ø£Ø²Ø±Ø¹Ù‡Ø§ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ³Ù…ØŸ',
                    'ÙƒÙŠÙ Ø£Ø³ØªØ¹Ø¯ Ù„Ù„Ø¬ÙØ§ÙØŸ',
                    'Ø£ÙØ¶Ù„ Ù…Ù…Ø§Ø±Ø³Ø§Øª Ø§Ù„Ø²Ø±Ø§Ø¹Ø© Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©',
                    'Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø³ÙˆÙ‚ Ù„Ù…Ù†Ø·Ù‚ØªÙŠ'
                ]
            },
            zh: {
                name: 'ä¸­æ–‡',
                welcome: 'æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„AIå†œä¸šåŠ©æ‰‹ã€‚æˆ‘å¯ä»¥ç”¨ä»»ä½•è¯­è¨€å¸®åŠ©æ‚¨è§£å†³å†œä¸šé—®é¢˜ã€‚ä»Šå¤©æˆ‘èƒ½ä¸ºæ‚¨åšäº›ä»€ä¹ˆï¼Ÿ',
                suggestions: [
                    'è¿™ä¸ªå­£èŠ‚æˆ‘åº”è¯¥ç§æ¤ä»€ä¹ˆä½œç‰©ï¼Ÿ',
                    'å¦‚ä½•ä¸ºå¹²æ—±åšå‡†å¤‡ï¼Ÿ',
                    'æœ‰æœºå†œä¸šæœ€ä½³å®è·µ',
                    'æˆ‘æ‰€åœ¨åœ°åŒºçš„å¸‚åœºä»·æ ¼'
                ]
            },
            pt: {
                name: 'PortuguÃªs',
                welcome: 'OlÃ¡! Sou seu assistente agrÃ­cola de IA. Posso ajudÃ¡-lo com questÃµes agrÃ­colas em qualquer idioma. Como posso ajudÃ¡-lo hoje?',
                suggestions: [
                    'Que culturas devo plantar esta temporada?',
                    'Como me preparar para a seca?',
                    'Melhores prÃ¡ticas para agricultura orgÃ¢nica',
                    'PreÃ§os de mercado para minha regiÃ£o'
                ]
            }
        };

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializeDarkMode();
            initializePoeAPI();
            setupEventListeners();
            initializeSpeechRecognition();
            updateLanguageInterface();
            loadRecentTopics();
        });

        // Dark mode initialization
        function initializeDarkMode() {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            });
        }

        // Initialize Poe API for AI responses
        function initializePoeAPI() {
            if (window.Poe && window.Poe.registerHandler) {
                window.Poe.registerHandler('ai-assistant-handler', handleAIResponse);
            }
        }

        // Handle AI responses from Poe
        function handleAIResponse(result, context) {
            const messages = result.responses;
            if (messages && messages.length > 0) {
                const aiMessage = messages[0];
                
                if (aiMessage.status === 'incomplete') {
                    updateAIMessage(aiMessage.content);
                } else if (aiMessage.status === 'complete') {
                    finalizeAIMessage(aiMessage.content);
                    isAIResponding = false;
                    
                    // Auto-translate if enabled and language is different
                    if (document.getElementById('autoTranslate').checked && currentLanguage !== 'en') {
                        translateMessage(aiMessage.content, currentLanguage);
                    }
                    
                    // Text-to-speech if voice mode is active
                    if (isVoiceRecording) {
                        speakText(aiMessage.content, currentLanguage);
                    }
                } else if (aiMessage.status === 'error') {
                    showAIError();
                    isAIResponding = false;
                }
            }
        }

        // Send message to AI using Poe API with multilingual support
        async function sendToAI(userMessage, language = currentLanguage) {
            if (isAIResponding) return;
            
            isAIResponding = true;
            addChatMessage(userMessage, true);
            showAIThinking();
            
            const contextPrompt = buildMultilingualAIPrompt(userMessage, language);
            
            try {
                if (window.Poe && window.Poe.sendUserMessage) {
                    await window.Poe.sendUserMessage(contextPrompt, {
                        handler: 'ai-assistant-handler',
                        stream: true,
                        openChat: false
                    });
                } else {
                    // Fallback to local AI simulation
                    setTimeout(() => {
                        const response = getLocalMultilingualAIResponse(userMessage, language);
                        finalizeAIMessage(response);
                        isAIResponding = false;
                    }, 1500);
                }
            } catch (error) {
                console.error('AI API error:', error);
                showAIError();
                isAIResponding = false;
            }
        }

        // Build multilingual AI prompt
        function buildMultilingualAIPrompt(userMessage, language) {
            const detectedLanguage = detectLanguage(userMessage);
            const responseLanguage = detectedLanguage || language;
            
            const conversationContext = conversationHistory.length > 0 ? 
                `Previous conversation: ${conversationHistory.slice(-3).map(msg => `${msg.type}: ${msg.content}`).join(' | ')}` : 
                '';
            
            const systemPrompt = `You are an expert multilingual agricultural advisor with deep knowledge in:
- Climate-smart agriculture and sustainable farming
- Crop management, soil health, and pest control
- Livestock management and animal husbandry
- Agricultural technology and modern farming techniques
- Market analysis and agricultural economics
- Environmental conservation and regenerative agriculture

Language Instructions:
- Detect the user's language from their message
- Respond in the SAME language the user is using
- If user uses English, respond in English
- If user uses Spanish, respond in Spanish
- If user uses French, respond in French
- If user uses Swahili, respond in Swahili
- If user uses Hindi, respond in Hindi
- If user uses Arabic, respond in Arabic
- If user uses Chinese, respond in Chinese
- If user uses Portuguese, respond in Portuguese
- For any other language, respond in that language
- For greetings in any language, respond warmly in the same language

Current user language preference: ${responseLanguage}
User's current message language: ${detectedLanguage || 'auto-detect'}

Guidelines:
- For greetings (hello, hi, hola, bonjour, hujambo, namaste, Ù…Ø±Ø­Ø¨Ø§, ä½ å¥½, olÃ¡), respond warmly as an agricultural expert
- Provide specific, actionable advice with exact measurements and timelines
- Consider local climate conditions and regional farming practices
- Include sustainable and climate-smart farming recommendations
- Be encouraging and supportive while being scientifically accurate
- Ask clarifying questions when needed for better assistance

${conversationContext}

User's agricultural question: ${userMessage}

Respond as a knowledgeable agricultural expert in the user's language:`;

            return `@Claude-Sonnet-4 ${systemPrompt}`;
        }

        // Detect language from text
        function detectLanguage(text) {
            const languagePatterns = {
                es: /\b(hola|buenos|dÃ­as|gracias|por favor|cÃ³mo|quÃ©|dÃ³nde|cuÃ¡ndo|espaÃ±ol)\b/i,
                fr: /\b(bonjour|salut|merci|s'il vous plaÃ®t|comment|que|oÃ¹|quand|franÃ§ais)\b/i,
                de: /\b(hallo|guten|tag|danke|bitte|wie|was|wo|wann|deutsch)\b/i,
                pt: /\b(olÃ¡|oi|obrigado|por favor|como|que|onde|quando|portuguÃªs)\b/i,
                sw: /\b(hujambo|jambo|asante|tafadhali|vipi|nini|wapi|lini|kiswahili)\b/i,
                hi: /[\u0900-\u097F]|namaste|dhanyawad|kripaya/i,
                ar: /[\u0600-\u06FF]|Ù…Ø±Ø­Ø¨Ø§|Ø´ÙƒØ±Ø§|Ù…Ù† ÙØ¶Ù„Ùƒ/i,
                zh: /[\u4e00-\u9fff]|ä½ å¥½|è°¢è°¢|è¯·/i,
                ja: /[\u3040-\u309f\u30a0-\u30ff\u4e00-\u9faf]|ã“ã‚“ã«ã¡ã¯|ã‚ã‚ŠãŒã¨ã†/i,
                ko: /[\uac00-\ud7af]|ì•ˆë…•í•˜ì„¸ìš”|ê°ì‚¬í•©ë‹ˆë‹¤/i,
                ru: /[\u0400-\u04FF]|Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚|ÑĞ¿Ğ°ÑĞ¸Ğ±Ğ¾|Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°/i
            };
            
            for (const [lang, pattern] of Object.entries(languagePatterns)) {
                if (pattern.test(text)) {
                    return lang;
                }
            }
            
            return null; // No specific language detected
        }

        // Local multilingual AI response fallback
        function getLocalMultilingualAIResponse(message, language) {
            const lowerMessage = message.toLowerCase();
            
            // Greeting responses in different languages
            const greetings = {
                en: {
                    patterns: /\b(hello|hi|hey|good morning|good afternoon|good evening|greetings)\b/i,
                    response: "Hello! I'm your multilingual AI agricultural advisor. I'm here to help you with all your farming questions in any language you're comfortable with. Whether you need advice on crops, livestock, soil management, or market trends, I'm ready to assist. What agricultural challenge can I help you solve today?"
                },
                es: {
                    patterns: /\b(hola|buenos dÃ­as|buenas tardes|buenas noches|saludos)\b/i,
                    response: "Â¡Hola! Soy tu asesor agrÃ­cola de IA multilingÃ¼e. Estoy aquÃ­ para ayudarte con todas tus preguntas sobre agricultura en cualquier idioma que te sientas cÃ³modo. Ya sea que necesites consejos sobre cultivos, ganado, manejo del suelo o tendencias del mercado, estoy listo para ayudarte. Â¿QuÃ© desafÃ­o agrÃ­cola puedo ayudarte a resolver hoy?"
                },
                fr: {
                    patterns: /\b(bonjour|salut|bonsoir|bonne journÃ©e)\b/i,
                    response: "Bonjour! Je suis votre conseiller agricole IA multilingue. Je suis lÃ  pour vous aider avec toutes vos questions agricoles dans n'importe quelle langue avec laquelle vous Ãªtes Ã  l'aise. Que vous ayez besoin de conseils sur les cultures, l'Ã©levage, la gestion des sols ou les tendances du marchÃ©, je suis prÃªt Ã  vous aider. Quel dÃ©fi agricole puis-je vous aider Ã  rÃ©soudre aujourd'hui?"
                },
                sw: {
                    patterns: /\b(hujambo|jambo|habari|salamu)\b/i,
                    response: "Hujambo! Mimi ni mshauri wako wa kilimo wa AI wa lugha nyingi. Nipo hapa kukusaidia na maswali yako yote ya kilimo kwa lugha yoyote unayostarehe nayo. Iwe unahitaji ushauri kuhusu mazao, mifugo, usimamizi wa udongo au mielekeo ya soko, niko tayari kukusaidia. Ni changamoto gani ya kilimo ninaweza kukusaidia kutatua leo?"
                },
                hi: {
                    patterns: /\b(à¤¨à¤®à¤¸à¥à¤¤à¥‡|à¤¨à¤®à¤¸à¥à¤•à¤¾à¤°|à¤¸à¥à¤ªà¥à¤°à¤­à¤¾à¤¤|à¤¶à¥à¤­ à¤¸à¤‚à¤§à¥à¤¯à¤¾)\b/i,
                    response: "à¤¨à¤®à¤¸à¥à¤¤à¥‡! à¤®à¥ˆà¤‚ à¤†à¤ªà¤•à¤¾ à¤¬à¤¹à¥à¤­à¤¾à¤·à¥€ AI à¤•à¥ƒà¤·à¤¿ à¤¸à¤²à¤¾à¤¹à¤•à¤¾à¤° à¤¹à¥‚à¤‚à¥¤ à¤®à¥ˆà¤‚ à¤¯à¤¹à¤¾à¤‚ à¤†à¤ªà¤•à¥€ à¤¸à¤­à¥€ à¤•à¥ƒà¤·à¤¿ à¤¸à¤‚à¤¬à¤‚à¤§à¥€ à¤¸à¤®à¤¸à¥à¤¯à¤¾à¤“à¤‚ à¤®à¥‡à¤‚ à¤•à¤¿à¤¸à¥€ à¤­à¥€ à¤­à¤¾à¤·à¤¾ à¤®à¥‡à¤‚ à¤¸à¤¹à¤¾à¤¯à¤¤à¤¾ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤¹à¥‚à¤‚ à¤œà¤¿à¤¸à¤®à¥‡à¤‚ à¤†à¤ª à¤¸à¤¹à¤œ à¤®à¤¹à¤¸à¥‚à¤¸ à¤•à¤°à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤ à¤šà¤¾à¤¹à¥‡ à¤†à¤ªà¤•à¥‹ à¤«à¤¸à¤²à¥‹à¤‚, à¤ªà¤¶à¥à¤§à¤¨, à¤®à¤¿à¤Ÿà¥à¤Ÿà¥€ à¤ªà¥à¤°à¤¬à¤‚à¤§à¤¨ à¤¯à¤¾ à¤¬à¤¾à¤œà¤¾à¤° à¤•à¥‡ à¤°à¥à¤à¤¾à¤¨ à¤•à¥‡ à¤¬à¤¾à¤°à¥‡ à¤®à¥‡à¤‚ à¤¸à¤²à¤¾à¤¹ à¤šà¤¾à¤¹à¤¿à¤, à¤®à¥ˆà¤‚ à¤®à¤¦à¤¦ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤¤à¥ˆà¤¯à¤¾à¤° à¤¹à¥‚à¤‚à¥¤ à¤†à¤œ à¤®à¥ˆà¤‚ à¤•à¤¿à¤¸ à¤•à¥ƒà¤·à¤¿ à¤šà¥à¤¨à¥Œà¤¤à¥€ à¤•à¥‹ à¤¹à¤² à¤•à¤°à¤¨à¥‡ à¤®à¥‡à¤‚ à¤†à¤ªà¤•à¥€ à¤®à¤¦à¤¦ à¤•à¤° à¤¸à¤•à¤¤à¤¾ à¤¹à¥‚à¤‚?"
                },
                ar: {
                    patterns: /\b(Ù…Ø±Ø­Ø¨Ø§|Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…|ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±|Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±)\b/i,
                    response: "Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ù…Ø³ØªØ´Ø§Ø±Ùƒ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù„ØºØ§Øª Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ. Ø£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø£Ø³Ø¦Ù„ØªÙƒ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠØ© Ø¨Ø£ÙŠ Ù„ØºØ© ØªØ´Ø¹Ø± Ø¨Ø§Ù„Ø±Ø§Ø­Ø© Ù…Ø¹Ù‡Ø§. Ø³ÙˆØ§Ø¡ ÙƒÙ†Øª ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù†ØµØ§Ø¦Ø­ Ø­ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§ØµÙŠÙ„ Ø£Ùˆ Ø§Ù„Ù…Ø§Ø´ÙŠØ© Ø£Ùˆ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨Ø© Ø£Ùˆ Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø§Ù„Ø³ÙˆÙ‚ØŒ Ø£Ù†Ø§ Ù…Ø³ØªØ¹Ø¯ Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©. Ù…Ø§ Ù‡Ùˆ Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠ Ø§Ù„Ø°ÙŠ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ Ø­Ù„Ù‡ Ø§Ù„ÙŠÙˆÙ…ØŸ"
                },
                zh: {
                    patterns: /\b(ä½ å¥½|æ‚¨å¥½|æ—©ä¸Šå¥½|ä¸‹åˆå¥½|æ™šä¸Šå¥½)\b/i,
                    response: "æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„å¤šè¯­è¨€AIå†œä¸šé¡¾é—®ã€‚æˆ‘åœ¨è¿™é‡Œç”¨æ‚¨èˆ’é€‚çš„ä»»ä½•è¯­è¨€å¸®åŠ©æ‚¨è§£å†³æ‰€æœ‰å†œä¸šé—®é¢˜ã€‚æ— è®ºæ‚¨éœ€è¦å…³äºä½œç‰©ã€ç•œç‰§ä¸šã€åœŸå£¤ç®¡ç†æˆ–å¸‚åœºè¶‹åŠ¿çš„å»ºè®®ï¼Œæˆ‘éƒ½å‡†å¤‡ä¸ºæ‚¨æä¾›å¸®åŠ©ã€‚ä»Šå¤©æˆ‘å¯ä»¥å¸®åŠ©æ‚¨è§£å†³ä»€ä¹ˆå†œä¸šæŒ‘æˆ˜ï¼Ÿ"
                },
                pt: {
                    patterns: /\b(olÃ¡|oi|bom dia|boa tarde|boa noite)\b/i,
                    response: "OlÃ¡! Sou seu consultor agrÃ­cola de IA multilÃ­ngue. Estou aqui para ajudÃ¡-lo com todas as suas questÃµes agrÃ­colas em qualquer idioma com o qual vocÃª se sinta confortÃ¡vel. Seja vocÃª precisando de conselhos sobre cultivos, pecuÃ¡ria, gestÃ£o do solo ou tendÃªncias de mercado, estou pronto para ajudar. Que desafio agrÃ­cola posso ajudÃ¡-lo a resolver hoje?"
                }
            };
            
            // Check for greetings in current language
            const currentLangGreeting = greetings[language];
            if (currentLangGreeting && currentLangGreeting.patterns.test(message)) {
                return currentLangGreeting.response;
            }
            
            // Check for greetings in any language
            for (const [lang, greeting] of Object.entries(greetings)) {
                if (greeting.patterns.test(message)) {
                    return greeting.response;
                }
            }
            
            // Topic-specific responses (in current language)
            const topicResponses = {
                en: {
                    crops: "For optimal crop selection, I recommend analyzing your soil type, local climate patterns, and market demand. Consider drought-resistant varieties like sorghum or millet for semi-arid regions, or high-value crops like tomatoes and peppers for areas with good water access. What's your specific location and farming goals?",
                    weather: "Weather monitoring is crucial for successful farming. I recommend checking daily weather forecasts, setting up rain gauges, and monitoring soil moisture levels. Current climate change patterns suggest more irregular rainfall, so consider water conservation techniques like mulching and drip irrigation. What specific weather challenges are you facing?",
                    livestock: "Successful livestock management requires attention to nutrition, health, and housing. For cattle, ensure adequate protein (14-16% for growing animals), provide clean water (30-50 gallons/day per cow), and maintain proper vaccination schedules. Which animals are you raising and what specific concerns do you have?",
                    market: "Market timing is essential for profitability. Current trends show strong demand for organic produce (+15% annually) and climate-resistant seeds. Consider value-addition through processing, direct-to-consumer sales, and cooperative marketing. What products are you planning to sell?"
                },
                es: {
                    crops: "Para una selecciÃ³n Ã³ptima de cultivos, recomiendo analizar su tipo de suelo, patrones climÃ¡ticos locales y demanda del mercado. Considere variedades resistentes a la sequÃ­a como sorgo o mijo para regiones semiÃ¡ridas, o cultivos de alto valor como tomates y pimientos para Ã¡reas con buen acceso al agua. Â¿CuÃ¡l es su ubicaciÃ³n especÃ­fica y objetivos agrÃ­colas?",
                    weather: "El monitoreo del clima es crucial para el Ã©xito agrÃ­cola. Recomiendo verificar los pronÃ³sticos diarios, instalar pluviÃ³metros y monitorear los niveles de humedad del suelo. Los patrones actuales del cambio climÃ¡tico sugieren precipitaciones mÃ¡s irregulares, asÃ­ que considere tÃ©cnicas de conservaciÃ³n de agua como mulching y riego por goteo. Â¿QuÃ© desafÃ­os climÃ¡ticos especÃ­ficos estÃ¡ enfrentando?",
                    livestock: "El manejo exitoso del ganado requiere atenciÃ³n a la nutriciÃ³n, salud y alojamiento. Para el ganado, asegure proteÃ­na adecuada (14-16% para animales en crecimiento), proporcione agua limpia (114-189 litros/dÃ­a por vaca), y mantenga horarios apropiados de vacunaciÃ³n. Â¿QuÃ© animales estÃ¡ criando y quÃ© preocupaciones especÃ­ficas tiene?",
                    market: "El timing del mercado es esencial para la rentabilidad. Las tendencias actuales muestran fuerte demanda por productos orgÃ¡nicos (+15% anualmente) y semillas resistentes al clima. Considere valor agregado a travÃ©s del procesamiento, ventas directas al consumidor, y marketing cooperativo. Â¿QuÃ© productos planea vender?"
                }
            };
            
            // Detect topic and respond in appropriate language
            if (lowerMessage.includes('crop') || lowerMessage.includes('plant') || lowerMessage.includes('cultivo') || lowerMessage.includes('mazao')) {
                return topicResponses[language]?.crops || topicResponses.en.crops;
            }
            
            if (lowerMessage.includes('weather') || lowerMessage.includes('climate') || lowerMessage.includes('clima') || lowerMessage.includes('hali ya hewa')) {
                return topicResponses[language]?.weather || topicResponses.en.weather;
            }
            
            if (lowerMessage.includes('livestock') || lowerMessage.includes('animal') || lowerMessage.includes('ganado') || lowerMessage.includes('mifugo')) {
                return topicResponses[language]?.livestock || topicResponses.en.livestock;
            }
            
            if (lowerMessage.includes('market') || lowerMessage.includes('price') || lowerMessage.includes('mercado') || lowerMessage.includes('soko')) {
                return topicResponses[language]?.market || topicResponses.en.market;
            }
            
            // Default response in user's language
            const defaultResponses = {
                en: "I'm here to help with all your agricultural questions! I can provide guidance on crops, weather, livestock, soil management, pest control, and market strategies. What specific farming challenge would you like assistance with?",
                es: "Â¡Estoy aquÃ­ para ayudar con todas sus preguntas agrÃ­colas! Puedo proporcionar orientaciÃ³n sobre cultivos, clima, ganado, manejo del suelo, control de plagas y estrategias de mercado. Â¿Con quÃ© desafÃ­o agrÃ­cola especÃ­fico le gustarÃ­a ayuda?",
                fr: "Je suis lÃ  pour vous aider avec toutes vos questions agricoles! Je peux vous donner des conseils sur les cultures, le climat, l'Ã©levage, la gestion des sols, la lutte antiparasitaire et les stratÃ©gies de marchÃ©. Pour quel dÃ©fi agricole spÃ©cifique aimeriez-vous de l'aide?",
                sw: "Nipo hapa kusaidia na maswali yako yote ya kilimo! Ninaweza kutoa mwongozo kuhusu mazao, hali ya hewa, mifugo, usimamizi wa udongo, udhibiti wa wadudu, na mikakati ya soko. Ni changamoto gani maalum ya kilimo ungependa msaada?",
                hi: "à¤®à¥ˆà¤‚ à¤†à¤ªà¤•à¥‡ à¤¸à¤­à¥€ à¤•à¥ƒà¤·à¤¿ à¤ªà¥à¤°à¤¶à¥à¤¨à¥‹à¤‚ à¤®à¥‡à¤‚ à¤®à¤¦à¤¦ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤¯à¤¹à¤¾à¤ à¤¹à¥‚à¤! à¤®à¥ˆà¤‚ à¤«à¤¸à¤²à¥‹à¤‚, à¤®à¥Œà¤¸à¤®, à¤ªà¤¶à¥à¤§à¤¨, à¤®à¤¿à¤Ÿà¥à¤Ÿà¥€ à¤ªà¥à¤°à¤¬à¤‚à¤§à¤¨, à¤•à¥€à¤Ÿ à¤¨à¤¿à¤¯à¤‚à¤¤à¥à¤°à¤£, à¤”à¤° à¤¬à¤¾à¤œà¤¾à¤° à¤°à¤£à¤¨à¥€à¤¤à¤¿à¤¯à¥‹à¤‚ à¤ªà¤° à¤®à¤¾à¤°à¥à¤—à¤¦à¤°à¥à¤¶à¤¨ à¤ªà¥à¤°à¤¦à¤¾à¤¨ à¤•à¤° à¤¸à¤•à¤¤à¤¾ à¤¹à¥‚à¤à¥¤ à¤†à¤ª à¤•à¤¿à¤¸ à¤µà¤¿à¤¶à¤¿à¤·à¥à¤Ÿ à¤•à¥ƒà¤·à¤¿ à¤šà¥à¤¨à¥Œà¤¤à¥€ à¤®à¥‡à¤‚ à¤¸à¤¹à¤¾à¤¯à¤¤à¤¾ à¤šà¤¾à¤¹à¥‡à¤‚à¤—à¥‡?",
                ar: "Ø£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø£Ø³Ø¦Ù„ØªÙƒ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠØ©! ÙŠÙ…ÙƒÙ†Ù†ÙŠ ØªÙ‚Ø¯ÙŠÙ… Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø­ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§ØµÙŠÙ„ ÙˆØ§Ù„Ø·Ù‚Ø³ ÙˆØ§Ù„Ù…Ø§Ø´ÙŠØ© ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨Ø© ÙˆÙ…ÙƒØ§ÙØ­Ø© Ø§Ù„Ø¢ÙØ§Øª ÙˆØ§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„Ø³ÙˆÙ‚. Ù…Ø§ Ù‡Ùˆ Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠ Ø§Ù„Ù…Ø­Ø¯Ø¯ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠÙ‡ØŸ",
                zh: "æˆ‘åœ¨è¿™é‡Œå¸®åŠ©è§£å†³æ‚¨æ‰€æœ‰çš„å†œä¸šé—®é¢˜ï¼æˆ‘å¯ä»¥æä¾›å…³äºä½œç‰©ã€å¤©æ°”ã€ç•œç‰§ä¸šã€åœŸå£¤ç®¡ç†ã€å®³è™«é˜²æ²»å’Œå¸‚åœºç­–ç•¥çš„æŒ‡å¯¼ã€‚æ‚¨å¸Œæœ›åœ¨å“ªä¸ªå…·ä½“çš„å†œä¸šæŒ‘æˆ˜æ–¹é¢è·å¾—å¸®åŠ©ï¼Ÿ",
                pt: "Estou aqui para ajudar com todas as suas questÃµes agrÃ­colas! Posso fornecer orientaÃ§Ã£o sobre cultivos, clima, pecuÃ¡ria, gestÃ£o do solo, controle de pragas e estratÃ©gias de mercado. Com que desafio agrÃ­cola especÃ­fico vocÃª gostaria de ajuda?"
            };
            
            return defaultResponses[language] || defaultResponses.en;
        }

        // Chat message management functions
        function addChatMessage(message, isUser = false) {
            const container = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex items-start space-x-3 ${isUser ? 'justify-end' : ''}`;
            
            if (isUser) {
                messageDiv.innerHTML = `
                    <div class="chat-bubble bg-primary text-white p-4 rounded-lg">
                        <p>${message}</p>
                    </div>
                    <div class="w-8 h-8 bg-secondary rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-user text-white text-sm"></i>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="w-8 h-8 ai-gradient rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-robot text-white text-sm"></i>
                    </div>
                    <div class="chat-bubble bg-gray-100 dark:bg-gray-700 p-4 rounded-lg">
                        <p class="text-gray-800 dark:text-white">${message}</p>
                    </div>
                `;
            }
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
            
            // Store in conversation history
            conversationHistory.push({
                type: isUser ? 'user' : 'assistant',
                content: message,
                language: currentLanguage,
                timestamp: new Date().toISOString()
            });
            
            // Save to recent topics
            if (isUser) {
                saveToRecentTopics(message);
            }
        }

        function showAIThinking() {
            const container = document.getElementById('chatMessages');
            const thinkingDiv = document.createElement('div');
            thinkingDiv.id = 'aiThinking';
            thinkingDiv.className = 'flex items-start space-x-3';
            
            thinkingDiv.innerHTML = `
                <div class="w-8 h-8 ai-gradient rounded-full flex items-center justify-center">
                    <i class="fas fa-robot text-white text-sm"></i>
                </div>
                <div class="chat-bubble bg-gray-100 dark:bg-gray-700 p-4 rounded-lg">
                    <div class="typing-indicator">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            `;
            
            container.appendChild(thinkingDiv);
            container.scrollTop = container.scrollHeight;
        }

        function updateAIMessage(content) {
            const thinkingElement = document.getElementById('aiThinking');
            if (thinkingElement) {
                thinkingElement.innerHTML = `
                    <div class="w-8 h-8 ai-gradient rounded-full flex items-center justify-center">
                        <i class="fas fa-robot text-white text-sm"></i>
                    </div>
                    <div class="chat-bubble bg-gray-100 dark:bg-gray-700 p-4 rounded-lg">
                        <p class="text-gray-800 dark:text-white">${content}</p>
                    </div>
                `;
            }
        }

        function finalizeAIMessage(content) {
            const thinkingElement = document.getElementById('aiThinking');
            if (thinkingElement) {
                thinkingElement.remove();
            }
            addChatMessage(content, false);
        }

        function showAIError() {
            const thinkingElement = document.getElementById('aiThinking');
            if (thinkingElement) {
                thinkingElement.remove();
            }
            
            const errorMessages = {
                en: "I apologize, but I'm having trouble responding right now. Please try asking your question again, or contact our support team for assistance.",
                es: "Me disculpo, pero estoy teniendo problemas para responder ahora mismo. Por favor, intente hacer su pregunta nuevamente, o contacte a nuestro equipo de soporte para asistencia.",
                fr: "Je m'excuse, mais j'ai des difficultÃ©s Ã  rÃ©pondre en ce moment. Veuillez essayer de poser votre question Ã  nouveau, ou contactez notre Ã©quipe de support pour de l'aide.",
                sw: "Naomba radhi, lakini nina matatizo ya kujibu sasa hivi. Tafadhali jaribu kuuliza swali lako tena, au wasiliana na timu yetu ya msaada.",
                hi: "à¤®à¥à¤à¥‡ à¤–à¥‡à¤¦ à¤¹à¥ˆ, à¤²à¥‡à¤•à¤¿à¤¨ à¤®à¥à¤à¥‡ à¤…à¤­à¥€ à¤œà¤µà¤¾à¤¬ à¤¦à¥‡à¤¨à¥‡ à¤®à¥‡à¤‚ à¤ªà¤°à¥‡à¤¶à¤¾à¤¨à¥€ à¤¹à¥‹ à¤°à¤¹à¥€ à¤¹à¥ˆà¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤…à¤ªà¤¨à¤¾ à¤ªà¥à¤°à¤¶à¥à¤¨ à¤«à¤¿à¤° à¤¸à¥‡ à¤ªà¥‚à¤›à¤¨à¥‡ à¤•à¥€ à¤•à¥‹à¤¶à¤¿à¤¶ à¤•à¤°à¥‡à¤‚, à¤¯à¤¾ à¤¸à¤¹à¤¾à¤¯à¤¤à¤¾ à¤•à¥‡ à¤²à¤¿à¤ à¤¹à¤®à¤¾à¤°à¥€ à¤¸à¤¹à¤¾à¤¯à¤¤à¤¾ à¤Ÿà¥€à¤® à¤¸à¥‡ à¤¸à¤‚à¤ªà¤°à¥à¤• à¤•à¤°à¥‡à¤‚à¥¤"
            };
            
            addChatMessage(errorMessages[currentLanguage] || errorMessages.en, false);
        }

        // Initialize speech recognition
        function initializeSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = getLanguageCode(currentLanguage);
                
                recognition.onstart = function() {
                    document.getElementById('voiceIcon').className = 'fas fa-microphone-slash text-white text-3xl voice-animation';
                    document.getElementById('voiceStatus').textContent = 'Listening... Speak now';
                };
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('chatInput').value = transcript;
                    document.getElementById('voiceModal').classList.add('hidden');
                    sendToAI(transcript, currentLanguage);
                };
                
                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    document.getElementById('voiceStatus').textContent = 'Error occurred. Try again.';
                    document.getElementById('voiceIcon').className = 'fas fa-microphone text-white text-3xl';
                };
                
                recognition.onend = function() {
                    document.getElementById('voiceIcon').className = 'fas fa-microphone text-white text-3xl';
                    document.getElementById('voiceStatus').textContent = 'Click to start speaking';
                    isVoiceRecording = false;
                };
            }
        }

        // Text-to-speech function
        function speakText(text, language) {
            if (synthesis) {
                synthesis.cancel(); // Stop any ongoing speech
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = getLanguageCode(language);
                utterance.rate = 0.9;
                utterance.pitch = 1;
                
                // Find a voice for the specified language
                const voices = synthesis.getVoices();
                const voice = voices.find(v => v.lang.startsWith(getLanguageCode(language))) || voices[0];
                if (voice) {
                    utterance.voice = voice;
                }
                
                synthesis.speak(utterance);
            }
        }

        // Get language code for speech API
        function getLanguageCode(language) {
            const languageCodes = {
                en: 'en-US',
                es: 'es-ES',
                fr: 'fr-FR',
                de: 'de-DE',
                zh: 'zh-CN',
                ja: 'ja-JP',
                ko: 'ko-KR',
                ar: 'ar-SA',
                hi: 'hi-IN',
                pt: 'pt-BR',
                ru: 'ru-RU',
                sw: 'sw-KE'
            };
            return languageCodes[language] || 'en-US';
        }

        // Translate message function
        async function translateMessage(text, targetLanguage) {
            // This would integrate with a translation API like Google Translate
            // For demo purposes, we'll show a placeholder
            const translatedMessage = `[Translated to ${languageConfig[targetLanguage]?.name || targetLanguage}]: ${text}`;
            
            // Add translated message as a system message
            const container = document.getElementById('chatMessages');
            const translateDiv = document.createElement('div');
            translateDiv.className = 'flex justify-center my-2';
            translateDiv.innerHTML = `
                <div class="bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 px-4 py-2 rounded-full text-sm">
                    <i class="fas fa-language mr-2"></i>${translatedMessage}
                </div>
            `;
            container.appendChild(translateDiv);
            container.scrollTop = container.scrollHeight;
        }

        // Update language interface
        function updateLanguageInterface() {
            const config = languageConfig[currentLanguage];
            if (config) {
                document.getElementById('welcomeMessage').textContent = config.welcome;
                document.getElementById('currentLanguage').textContent = config.name;
                updateQuickSuggestions();
            }
        }

        // Update quick suggestions based on language
        function updateQuickSuggestions() {
            const container = document.getElementById('quickSuggestions');
            const config = languageConfig[currentLanguage];
            
            container.innerHTML = '';
            
            if (config && config.suggestions) {
                config.suggestions.forEach(suggestion => {
                    const button = document.createElement('button');
                    button.className = 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 px-3 py-1 rounded-full text-sm hover:bg-primary hover:text-white transition-colors';
                    button.textContent = suggestion;
                    button.addEventListener('click', () => {
                        document.getElementById('chatInput').value = suggestion;
                        sendToAI(suggestion, currentLanguage);
                    });
                    container.appendChild(button);
                });
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Mobile menu
            document.getElementById('mobileMenuButton').addEventListener('click', function() {
                document.getElementById('mobileMenu').classList.add('active');
            });

            document.getElementById('closeMobileMenu').addEventListener('click', function() {
                document.getElementById('mobileMenu').classList.remove('active');
            });

            // Mobile dropdown functionality
            document.querySelectorAll('.mobile-dropdown-toggle').forEach(button => {
                button.addEventListener('click', function() {
                    const content = this.nextElementSibling;
                    content.classList.toggle('hidden');
                    const icon = this.querySelector('i');
                    icon.classList.toggle('fa-chevron-down');
                    icon.classList.toggle('fa-chevron-up');
                });
            });

            // Language selectors
            document.getElementById('languageSelector').addEventListener('change', function() {
                currentLanguage = this.value;
                updateLanguageInterface();
                if (recognition) {
                    recognition.lang = getLanguageCode(currentLanguage);
                }
            });

            document.getElementById('preferredLanguage').addEventListener('change', function() {
                currentLanguage = this.value;
                updateLanguageInterface();
                if (recognition) {
                    recognition.lang = getLanguageCode(currentLanguage);
                }
            });

            document.getElementById('chatLanguage').addEventListener('change', function() {
                currentLanguage = this.value;
                updateLanguageInterface();
            });

            // Chat functionality
            document.getElementById('sendMessage').addEventListener('click', handleChatMessage);
            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleChatMessage();
                }
            });

            // Voice assistant
            document.getElementById('voiceAssistant').addEventListener('click', function() {
                document.getElementById('voiceModal').classList.remove('hidden');
            });

            document.getElementById('voiceInput').addEventListener('click', function() {
                document.getElementById('voiceModal').classList.remove('hidden');
            });

            document.getElementById('startVoice').addEventListener('click', function() {
                if (recognition) {
                    isVoiceRecording = true;
                    recognition.start();
                } else {
                    alert('Speech recognition is not supported in this browser.');
                }
            });

            document.getElementById('closeVoiceModal').addEventListener('click', function() {
                document.getElementById('voiceModal').classList.add('hidden');
                if (recognition) {
                    recognition.stop();
                }
            });

            // Chat controls
            document.getElementById('clearChat').addEventListener('click', clearChat);
            document.getElementById('downloadChat').addEventListener('click', downloadChat);

            // Feature buttons
            document.getElementById('expertMode').addEventListener('click', () => {
                sendToAI('Please switch to expert mode and provide advanced agricultural analysis capabilities.', currentLanguage);
            });

            document.getElementById('quickTranslate').addEventListener('click', () => {
                showTranslationModal();
            });

            // Recent topics
            document.getElementById('recentTopics').addEventListener('click', function(e) {
                if (e.target.tagName === 'BUTTON') {
                    const topic = e.target.textContent;
                    document.getElementById('chatInput').value = topic;
                    sendToAI(topic, currentLanguage);
                }
            });
        }

        // Handle chat message sending
        function handleChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message && !isAIResponding) {
                // Auto-detect language if enabled
                if (document.getElementById('autoDetect').checked) {
                    const detectedLang = detectLanguage(message);
                    if (detectedLang && detectedLang !== currentLanguage) {
                        currentLanguage = detectedLang;
                        updateLanguageInterface();
                        document.getElementById('chatLanguage').value = detectedLang;
                    }
                }
                
                sendToAI(message, currentLanguage);
                input.value = '';
            }
        }

        // Clear chat function
        function clearChat() {
            document.getElementById('chatMessages').innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 ai-gradient rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-robot text-white text-sm"></i>
                    </div>
                    <div class="chat-bubble bg-gray-100 dark:bg-gray-700 p-4 rounded-lg">
                        <p id="welcomeMessage" class="text-gray-800 dark:text-white">${languageConfig[currentLanguage]?.welcome || languageConfig.en.welcome}</p>
                    </div>
                </div>
            `;
            conversationHistory = [];
        }

        // Download chat function
        function downloadChat() {
            const chatContent = conversationHistory.map(msg => 
                `[${msg.timestamp}] ${msg.type.toUpperCase()} (${msg.language}): ${msg.content}`
            ).join('\n\n');
            
            const blob = new Blob([chatContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `agriclimate-chat-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Save to recent topics
        function saveToRecentTopics(message) {
            const recentTopics = JSON.parse(localStorage.getItem('recentTopics') || '[]');
            
            // Add new topic (limit to first 50 characters)
            const topic = message.length > 50 ? message.substring(0, 50) + '...' : message;
            
            if (!recentTopics.includes(topic)) {
                recentTopics.unshift(topic);
                
                // Keep only last 10 topics
                if (recentTopics.length > 10) {
                    recentTopics.pop();
                }
                
                localStorage.setItem('recentTopics', JSON.stringify(recentTopics));
                updateRecentTopicsDisplay();
            }
        }

        // Load recent topics
        function loadRecentTopics() {
            updateRecentTopicsDisplay();
        }

        // Update recent topics display
        function updateRecentTopicsDisplay() {
            const recentTopics = JSON.parse(localStorage.getItem('recentTopics') || '[]');
            const container = document.getElementById('recentTopics');
            
            container.innerHTML = '';
            
            if (recentTopics.length === 0) {
                container.innerHTML = `
                    <div class="text-sm text-gray-600 dark:text-gray-400 text-center py-4">
                        Your recent topics will appear here
                    </div>
                `;
            } else {
                recentTopics.forEach(topic => {
                    const button = document.createElement('button');
                    button.className = 'w-full text-left p-2 text-sm text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors';
                    button.textContent = topic;
                    container.appendChild(button);
                });
            }
        }

        // Show translation modal
        function showTranslationModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-xl max-w-md w-full p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-800 dark:text-white">Quick Translation</h2>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm text-gray-600 dark:text-gray-300 mb-1">Text to translate</label>
                            <textarea id="translateText" rows="3" placeholder="Enter text to translate..." class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:border-primary dark:bg-gray-700 dark:text-white"></textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm text-gray-600 dark:text-gray-300 mb-1">From</label>
                                <select id="fromLanguage" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:border-primary dark:bg-gray-700 dark:text-white">
                                    <option value="auto">Auto-detect</option>
                                    <option value="en">English</option>
                                    <option value="es">EspaÃ±ol</option>
                                    <option value="fr">FranÃ§ais</option>
                                    <option value="sw">Kiswahili</option>
                                    <option value="hi">à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
                                    <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-600 dark:text-gray-300 mb-1">To</label>
                                <select id="toLanguage" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:border-primary dark:bg-gray-700 dark:text-white">
                                    <option value="en">English</option>
                                    <option value="es">EspaÃ±ol</option>
                                    <option value="fr">FranÃ§ais</option>
                                    <option value="sw">Kiswahili</option>
                                    <option value="hi">à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
                                    <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                                </select>
                            </div>
                        </div>
                        <button onclick="performTranslation()" class="w-full bg-primary text-white py-2 rounded hover:bg-secondary transition-colors">
                            <i class="fas fa-language mr-2"></i>Translate
                        </button>
                        <div id="translationResult" class="hidden mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <div class="text-sm text-gray-600 dark:text-gray-300 mb-1">Translation:</div>
                            <div id="translatedText" class="text-gray-800 dark:text-white"></div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Perform translation (demo function)
        function performTranslation() {
            const text = document.getElementById('translateText').value;
            const fromLang = document.getElementById('fromLanguage').value;
            const toLang = document.getElementById('toLanguage').value;
            
            if (!text.trim()) {
                alert('Please enter text to translate');
                return;
            }
            
            // Demo translation - in real implementation, this would call a translation API
            const demoTranslations = {
                'en-es': 'TraducciÃ³n de demostraciÃ³n del texto',
                'en-fr': 'Traduction de dÃ©monstration du texte',
                'en-sw': 'Tafsiri ya onyesho ya maandishi',
                'en-hi': 'à¤ªà¤¾à¤  à¤•à¤¾ à¤¡à¥‡à¤®à¥‹ à¤…à¤¨à¥à¤µà¤¾à¤¦',
                'en-ar': 'ØªØ±Ø¬Ù…Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ù†Øµ'
            };
            
            const translationKey = `${fromLang === 'auto' ? 'en' : fromLang}-${toLang}`;
            const translation = demoTranslations[translationKey] || `[Demo translation to ${toLang}]: ${text}`;
            
            document.getElementById('translatedText').textContent = translation;
            document.getElementById('translationResult').classList.remove('hidden');
        }

        // Global functions for modal access
        window.performTranslation = performTranslation;
    </script>
</body>
</html>